<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌱 Unkraut-2025 System Dokumentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-align: center;
        }
        
        h2 {
            color: #2c3e50;
            border-left: 4px solid #667eea;
            padding-left: 15px;
            margin: 30px 0 15px 0;
            font-size: 1.5em;
        }
        
        h3 {
            color: #34495e;
            margin: 20px 0 10px 0;
        }
        
        .timeline {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .timeline table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .timeline th,
        .timeline td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .timeline th {
            background: rgba(102, 126, 234, 0.1);
            font-weight: bold;
            color: #2c3e50;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .code-block:hover {
            background: #4a5568;
        }
        
        .code-block::before {
            content: "📋 Click to copy";
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        .code-block.copied::before {
            content: "✅ Copied!";
            color: #48bb78;
        }
        
        .file-tree {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .status-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .status-card:hover {
            transform: translateY(-5px);
        }
        
        .status-card h3 {
            color: white;
            margin-bottom: 10px;
        }
        
        .checklist {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
        }
        
        .checklist ul {
            list-style: none;
            margin-left: 0;
        }
        
        .checklist li::before {
            content: "✅ ";
            margin-right: 10px;
        }
        
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }
        
        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }
        
        .command {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 5px;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            display: inline-block;
            margin: 5px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .feature:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌱 Unkraut-2025 - Autonomes Raspberry Pi System</h1>
        
        <div class="info">
            <strong>📖 Vollständige Dokumentation</strong> für das batteriebetriebene, autonome Raspberry Pi System mit automatischer Zeit-Synchronisation, Flask-Server und 8-Stunden-Laufzeit.
        </div>

        <h2>🎯 System-Übersicht</h2>
        
        <div class="feature-grid">
            <div class="feature">
                <h3>🕐 Zeit-Sync</h3>
                <p>SSH-basiert ohne NTP</p>
            </div>
            <div class="feature">
                <h3>🐍 Flask Server</h3>
                <p>Mit Virtual Environment</p>
            </div>
            <div class="feature">
                <h3>🔋 Auto-Shutdown</h3>
                <p>Nach 8 Stunden</p>
            </div>
            <div class="feature">
                <h3>📊 Monitoring</h3>
                <p>Alle 5 Minuten</p>
            </div>
            <div class="feature">
                <h3>📡 Access Point</h3>
                <p>192.168.251.1</p>
            </div>
        </div>

        <h2>⏰ Boot-Timeline</h2>
        
        <div class="timeline">
            <table>
                <thead>
                    <tr>
                        <th>Zeit</th>
                        <th>Aktion</th>
                        <th>Beschreibung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>0s</strong></td>
                        <td>🚀 System Boot</td>
                        <td>Raspberry Pi startet</td>
                    </tr>
                    <tr>
                        <td><strong>0s</strong></td>
                        <td>📊 Uptime-Log</td>
                        <td>Boot-Script startet</td>
                    </tr>
                    <tr>
                        <td><strong>130s</strong></td>
                        <td>🕐 Zeit-Sync</td>
                        <td>Zeit-Synchronisation via SSH</td>
                    </tr>
                    <tr>
                        <td><strong>140s</strong></td>
                        <td>🐍 Flask Start</td>
                        <td>Web-Server startet</td>
                    </tr>
                    <tr>
                        <td><strong>8h</strong></td>
                        <td>🔴 Shutdown</td>
                        <td>Automatisches Herunterfahren</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>📁 Verzeichnisstruktur</h2>
        
        <div class="file-tree">
<pre>/home/jan/
├── bin/
│   └── create_uptime_log.sh           # Uptime Boot-Script
└── robo/claude/unkraut/
    ├── venv/                          # Python Virtual Environment
    ├── run.py                         # Flask Haupt-Script
    └── scripts/
        ├── time_sync.sh               # Zeit-Synchronisation
        ├── auto_shutdown.sh           # 8h Auto-Shutdown
        ├── setup_bash_time_sync.sh    # Zeit-Sync Setup
        ├── setup_flask_autostart.sh   # Flask Setup
        ├── config/
        │   └── time_sync_hosts.conf   # Zeit-Server Konfiguration
        └── logs/
            ├── time_sync.log          # Zeit-Sync Logs
            └── auto_shutdown.log      # Shutdown Logs</pre>
        </div>

        <h2>🔧 Aktuelle Cron-Jobs</h2>
        
        <div class="code-block" onclick="copyToClipboard(this)">
<pre># Crontab Inhalt (crontab -l)
# m h  dom mon dow   command

# Boot-Script beim Systemstart
@reboot /home/jan/bin/create_uptime_log.sh

# Uptime alle 5 Minuten loggen
*/5 * * * * echo "$(date): $(uptime)" > /tmp/uptime

# Zeit synchronisieren nach 130 sec
@reboot sleep 130 && /home/jan/robo/claude/unkraut/scripts/time_sync.sh >/dev/null 2>&1

# Nach 8 std ist Schluss dann shutdown
@reboot /home/jan/robo/claude/unkraut/scripts/auto_shutdown.sh >/dev/null 2>&1</pre>
        </div>

        <h2>🐍 Flask Systemd Service</h2>
        
        <div class="code-block" onclick="copyToClipboard(this)">
<pre># /etc/systemd/system/flask-unkraut.service
[Unit]
Description=Unkraut Flask Server
After=network.target
Wants=network.target

[Service]
Type=simple
User=jan
Group=jan
WorkingDirectory=/home/jan/robo/claude/unkraut
Environment=PYTHONPATH=/home/jan/robo/claude/unkraut
Environment=FLASK_ENV=production
Environment=PATH=/home/jan/robo/claude/unkraut/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
ExecStartPre=/bin/sleep 140
ExecStart=/home/jan/robo/claude/unkraut/venv/bin/python /home/jan/robo/claude/unkraut/run.py
Restart=always
RestartSec=10
TimeoutStartSec=180
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target</pre>
        </div>

        <h2>🕐 Zeit-Synchronisation Konfiguration</h2>
        
        <div class="code-block" onclick="copyToClipboard(this)">
<pre># scripts/config/time_sync_hosts.conf
# Format: PRIORITÄT|HOST|USER|SSH_OPTIONS

# VERBUNDENER CLIENT - HÖCHSTE PRIORITÄT  
1|192.168.251.70|jan|-o ConnectTimeout=3 -o StrictHostKeyChecking=no

# BACKUP ZEITSERVER
2|pool.ntp.org|ubuntu|-o ConnectTimeout=5 -o StrictHostKeyChecking=no
3|time.google.com|user|-o ConnectTimeout=5 -o StrictHostKeyChecking=no
4|de.pool.ntp.org|pi|-o ConnectTimeout=5 -o StrictHostKeyChecking=no</pre>
        </div>

        <h2>🚀 Installation & Setup</h2>
        
        <div class="checklist">
            <h3>Komplett-Setup:</h3>
            <ul>
                <li>Zeit-Synchronisation installieren</li>
                <li>Flask Auto-Start installieren</li>
                <li>Alle Scripts ausführbar machen</li>
                <li>Cron-Jobs sind bereits installiert</li>
            </ul>
        </div>
        
        <div class="code-block" onclick="copyToClipboard(this)">
<pre>cd $HOME/robo/claude/unkraut

# Zeit-Synchronisation installieren
chmod +x scripts/setup_bash_time_sync.sh
./scripts/setup_bash_time_sync.sh

# Flask Auto-Start installieren  
chmod +x scripts/setup_flask_autostart.sh
./scripts/setup_flask_autostart.sh

# Alle Scripts ausführbar machen
chmod +x scripts/*.sh</pre>
        </div>

        <h2>📊 System-Monitoring</h2>
        
        <div class="status-grid">
            <div class="status-card">
                <h3>🐍 Flask Service</h3>
                <div class="command">sudo systemctl status flask-unkraut</div>
            </div>
            <div class="status-card">
                <h3>🕐 Zeit-Sync</h3>
                <div class="command">tail -f scripts/logs/time_sync.log</div>
            </div>
            <div class="status-card">
                <h3>🔋 Auto-Shutdown</h3>
                <div class="command">tail -f scripts/logs/auto_shutdown.log</div>
            </div>
            <div class="status-card">
                <h3>📊 Uptime</h3>
                <div class="command">cat /tmp/uptime</div>
            </div>
        </div>

        <h2>🌐 Web-Zugriff</h2>
        
        <div class="info">
            <ul>
                <li><strong>Flask Server:</strong> <a href="http://192.168.251.1:5000">http://192.168.251.1:5000</a></li>
                <li><strong>Cockpit:</strong> <a href="https://192.168.251.1:9090">https://192.168.251.1:9090</a></li>
            </ul>
        </div>
        
        <div class="code-block" onclick="copyToClipboard(this)">
<pre># Von verbundenem Client testen:
curl http://192.168.251.1:5000
curl http://192.168.251.1:5000/health</pre>
        </div>

        <h2>🔋 Batterie-Management</h2>
        
        <div class="warning">
            <strong>⚠️ 8-Stunden Auto-Shutdown:</strong>
            <ul>
                <li>Warnung: 30 Minuten vor Shutdown</li>
                <li>Graceful Shutdown: Alle Services werden sauber beendet</li>
                <li>Log-Eintrag: Shutdown-Grund wird protokolliert</li>
            </ul>
        </div>

        <h2>🔧 Wartung & Debugging</h2>
        
        <h3>Service-Verwaltung:</h3>
        <div class="code-block" onclick="copyToClipboard(this)">
<pre># Flask Service steuern
sudo systemctl start flask-unkraut
sudo systemctl stop flask-unkraut
sudo systemctl restart flask-unkraut
sudo systemctl disable flask-unkraut  # Boot-Start deaktivieren

# Service-Status
sudo systemctl status flask-unkraut --no-pager -l</pre>
        </div>

        <h3>Manuelle Tests:</h3>
        <div class="code-block" onclick="copyToClipboard(this)">
<pre># Zeit-Sync manuell ausführen
cd ~/robo/claude/unkraut
./scripts/time_sync.sh

# Flask manuell starten
source venv/bin/activate
python run.py

# Auto-Shutdown testen (VORSICHT!)
./scripts/auto_shutdown.sh</pre>
        </div>

        <h2>📋 Checkliste nach Reboot</h2>
        
        <div class="checklist">
            <ul>
                <li><strong>0-2 Min:</strong> System hochgefahren</li>
                <li><strong>2-3 Min:</strong> Zeit-Sync erfolgreich</li>
                <li><strong>3-4 Min:</strong> Flask Server läuft</li>
                <li><strong>Laufend:</strong> Uptime wird alle 5 Min geloggt</li>
                <li><strong>8h später:</strong> Automatischer Shutdown</li>
            </ul>
        </div>
        
        <div class="code-block" onclick="copyToClipboard(this)">
<pre># Status schnell prüfen - alles in einem Befehl:
echo "=== SYSTEM STATUS ===" && \
date && \
uptime && \
sudo systemctl is-active flask-unkraut && \
tail -1 scripts/logs/time_sync.log && \
echo "Flask Response:" && curl -s http://localhost:5000</pre>
        </div>

        <h2>🎉 Fazit</h2>
        
        <div class="info">
            Das Unkraut-2025 System ist ein vollständig autonomes, batteriebetriebenes Raspberry Pi Setup mit:
            <ul>
                <li><strong>Zuverlässiger Zeit-Synchronisation</strong> ohne Internet-Abhängigkeit</li>
                <li><strong>Robustem Flask Web-Server</strong> mit Auto-Restart</li>
                <li><strong>Intelligentem Batterie-Management</strong> mit 8h Laufzeit</li>
                <li><strong>Professionellem Logging</strong> aller Komponenten</li>
                <li><strong>Einfacher Wartung</strong> über standardisierte Tools</li>
            </ul>
            
            <p><strong>Ideal für:</strong> IoT-Projekte, Feldstudien, temporäre Installationen, Prototyping</p>
            <p><strong>Getestet auf:</strong> Raspberry Pi mit Debian/Raspbian, Python 3.x, systemd</p>
        </div>

        <div style="text-align: center; margin-top: 40px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; color: white;">
            <h3>🌱 Unkraut-2025 Projekt</h3>
            <p>Robuste Zeit-Synchronisation für alle Szenarien!</p>
        </div>
    </div>

    <script>
        function copyToClipboard(element) {
            // Finde das <pre> Element innerhalb des angeklickten code-blocks
            const preElement = element.querySelector('pre');
            const text = preElement ? preElement.textContent : element.textContent;
            
            // Verwende die moderne Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showCopyFeedback(element);
                }).catch(err => {
                    console.error('Fehler beim Kopieren: ', err);
                    fallbackCopy(text, element);
                });
            } else {
                // Fallback für ältere Browser
                fallbackCopy(text, element);
            }
        }

        function fallbackCopy(text, element) {
            // Erstelle ein temporäres textarea Element
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopyFeedback(element);
            } catch (err) {
                console.error('Fallback copy failed: ', err);
            }
            
            document.body.removeChild(textArea);
        }

        function showCopyFeedback(element) {
            // Füge "copied" Klasse hinzu für visuelles Feedback
            element.classList.add('copied');
            
            // Entferne die Klasse nach 2 Sekunden
            setTimeout(() => {
                element.classList.remove('copied');
            }, 2000);
        }

        // Optional: Keyboard shortcut für copy (Ctrl+C auf code-blocks)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'c') {
                const focusedElement = document.activeElement;
                if (focusedElement && focusedElement.classList.contains('code-block')) {
                    e.preventDefault();
                    copyToClipboard(focusedElement);
                }
            }
        });
    </script>
</body>
</html>